<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prenotazione Tratta</title>
</head>
<body>
  <h1>Prenotazione Tratta</h1>
  <form id="form">
    <label>
      Nome e Cognome:
      <input type="text" name="nome_cognome" required />
    </label><br><br>

    <label>
      Tratta (PM se Palau-Maddalena, MP se Maddalena-Palau):
      <input type="text" name="tratta" id="tratta" required />
    </label><br><br>

    <label>
      Giorno viaggio (in numero):
      <input type="number" name="giorno" min="1" max="31" required />
    </label><br><br>

    <label>
      Mese viaggio (in numero):
      <input type="text" name="mese" required />
    </label><br><br>

    <label>
      Numero Adulti:
      <input type="number" name="adulti" min="0" required />
    </label><br><br>

    <label>
      Numero Bambini (4-11):
      <input type="number" name="bambini" min="0" required />
    </label><br><br>

    <label>
      Numero Neonati:
      <input type="number" name="neonati" min="0" />
    </label><br><br>

    <label>
      Numero Moto:
      <input type="number" name="moto" min="0" required />
    </label><br><br>

    <label>
      Numero Auto:
      <input type="number" name="auto" min="0" required />
    </label><br><br>

    <label>
      Orario viaggio (non compare se non hai indicato la tratta!):
      <select name="orario" id="orario" required>
        <option value="">-- Seleziona un orario --</option>
      </select>
    </label><br><br>

    <button type="submit">Invia</button>
  </form>

  <script>
    const trattaInput = document.getElementById('tratta');
    const orarioSelect = document.getElementById('orario');

    const orariPM = [
      "06:30", "07:30", "08:00", "08:30", "09:10", "09:30", "10:10", "10:30",
      "11:10", "11:30", "12:10", "12:30", "13:10", "13:30", "14:00", "14:45",
      "15:45", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00", "19:30",
      "20:00", "21:00", "22:00", "23:00", "00:00", "01:00", "02:00", "03:30",
      "04:30", "05:30"
    ];

    const orariMP = [
      "06:00", "07:00", "07:30", "08:00", "08:40", "09:00", "09:40", "10:00",
      "10:40", "11:00", "11:40", "12:00", "12:40", "13:00", "13:40", "14:15",
      "15:15", "16:00", "16:30", "17:00", "17:30", "18:00", "18:30", "19:00",
      "19:30", "20:30", "21:30", "22:30", "23:30", "00:30", "01:30", "03:00",
      "04:00", "04:55"
    ];

    trattaInput.addEventListener('input', () => {
      const tratta = trattaInput.value.trim().toUpperCase();
      let orari = [];

      if (tratta === "PM") {
        orari = orariPM;
      } else if (tratta === "MP") {
        orari = orariMP;
      }

      // Pulisce e riempie il select
      orarioSelect.innerHTML = '<option value="">-- Seleziona un orario --</option>';
      orari.forEach(ora => {
        const option = document.createElement("option");
        option.value = ora;
        option.textContent = ora;
        orarioSelect.appendChild(option);
      });
    });

    document.getElementById('form').addEventListener('submit', async function (e) {
      e.preventDefault();

      const data = {
        nome_cognome: this.nome_cognome.value,
        tratta: this.tratta.value,
        giorno: this.giorno.value,
        mese: this.mese.value,
        adulti: this.adulti.value,
        bambini: this.bambini.value,
        neonati: this.neonati.value,
        moto: this.moto.value,
        auto: this.auto.value,
        orario: this.orario.value
      };

      const response = await fetch("https://tuo-backend.replit.app/invia", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        alert("Dati inviati correttamente!");
      } else {
        alert("Errore nell'invio dei dati.");
      }
    });
  </script>
</body>
</html>

